(function(){"use strict";var e={5278:function(e,t,r){var n=r(6848),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("MapPage")],1)},s=[],o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"full-screen"},[t("div",{staticClass:"map-container",attrs:{id:"map"}}),t("div",{staticClass:"control-panel"},[t("div",{staticClass:"panel-section"},[t("div",{staticClass:"section-title"},[e._v("图层")]),e._l(e.layerList,(function(r,n){return t("div",{key:n,staticClass:"layer-item"},[t("input",{attrs:{type:"checkbox",id:`layer${n}`},domProps:{checked:r.checked},on:{click:function(t){return e.handleLayerClick(r,n)}}}),t("label",{attrs:{for:`layer${n}`}},[e._v(e._s(r.name))])])}))],2),t("div",{staticClass:"panel-section"},[t("div",{staticClass:"section-title"},[e._v("分析")]),t("div",{staticClass:"analysis-item"},[t("div",{staticClass:"analysis-label"},[e._v("分析范围")]),t("div",{staticClass:"analysis-input"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.bufferDistance,expression:"bufferDistance",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:e.bufferDistance},on:{input:[function(t){t.target.composing||(e.bufferDistance=e._n(t.target.value))},e.validateBufferDistance],blur:function(t){return e.$forceUpdate()}}}),t("span",{staticClass:"unit"},[e._v("km")])])]),t("div",{staticClass:"analysis-item button-group"},[t("button",{staticClass:"upload-btn",on:{click:e.drawPolygon}},[e._v("绘制")]),t("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"fileInput",accept:".geojson"},on:{change:e.handleFileUpload}}),t("button",{staticClass:"upload-btn",on:{click:e.triggerFileInput}},[e._v("上传文件")])]),t("div",{staticClass:"analysis-item"},[t("button",{staticClass:"analysis-btn",on:{click:e.analysisEvaluate}},[e._v(" 分析评估 ")])]),t("div",[t("button",{staticClass:"clear-btn",on:{click:e.clear}},[e._v("清除")])])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isAnalysis,expression:"isAnalysis"}],staticClass:"left-bottom-panel"},[t("div",{staticClass:"panel-section"},[t("div",{staticClass:"section-title"},[e._v("输出结果")]),t("div",{staticClass:"result-item"},[e.analysisResult.length>0?[e._v(" 存在交集：选址与"+e._s(e.analysisResult.join("/"))+"存在交集，请注意复核是否存在冲突 ")]:[e._v(" 不存在交集 ")]],2)])])])},i=[],l=(r(4114),r(8111),r(2489),r(116),r(7588),r(1701),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(2488),r(8868)),c=r(8699),u=r(8047),d=r(9298),f=r(4190),y=r(9449),h=r(4453),p=r(995),g=r(6505),w=r(8343),m=r(5782),v=r(2123),A=r(5274);class b{constructor(e){if(!(e instanceof l.A))throw new Error("Invalid map object");this.map=e,this.updateZIndex()}addLayer(e){this.map.addLayer(e),this.updateZIndex()}removeLayer(e){this.map.removeLayer(e),this.updateZIndex()}getLayers(){return this.map.getLayers().getArray()}moveLayerUp(e){const t=this.getLayers(),r=t.indexOf(e);r>0&&(t.splice(r,1),t.splice(r-1,0,e),this.updateZIndex())}moveLayerDown(e){const t=this.getLayers(),r=t.indexOf(e);r<t.length-1&&(t.splice(r,1),t.splice(r+1,0,e),this.updateZIndex())}swapLayers(e,t){const r=this.getLayers(),n=r.indexOf(e),a=r.indexOf(t);-1!==n&&-1!==a&&(r[n]=t,r[a]=e,this.updateZIndex())}updateZIndex(){const e=this.getLayers();e.forEach(((e,t)=>{e.setZIndex(t)}))}}var L=b,j=r(8763);class S{constructor(e,t){this.map=e,this.layer=t,this.draw=null}addInteraction(e,t,r){this.draw&&this.map.removeInteraction(this.draw),this.draw=new j.Ay({source:this.layer.getSource(),type:e,style:r||new g.Ay({fill:new w.A({color:"rgba(255, 255, 255, 0.5)"}),stroke:new m.A({color:"#ffcc33",width:2}),image:new A.A({radius:7,fill:new w.A({color:"#ffcc33"})})})}),this.map.addInteraction(this.draw),this.draw.on("drawend",(e=>{this.map.removeInteraction(this.draw),t&&t(e.feature)}))}drawPoint(e,t){this.addInteraction("Point",e,t)}drawLine(e,t){this.addInteraction("LineString",e,t)}drawPolygon(e,t){this.addInteraction("Polygon",e,t)}}var C=S,k=r(3277),P=r(3754),x=r(3496),G=r(856),I=r(5897),E=r(1423),_=r(7867),O=r(3369),F=r(383),D=r(2674);class Z{static calculateArea(e){let t=e.getGeometry();if(!(t instanceof P.Ay))throw new Error("Invalid polygon object");const r=(0,k.UG)(t),n=(0,k.UG)(t,window.map.getView().getProjection()),a=(new v.A).writeFeatureObject(e,{featureProjection:"EPSG:3857"}),s=I.W(a),o=t.getArea();return console.log("area",r),console.log("area2",o),console.log("area3",s),console.log("area4",n),r}static calculateLength(e){let t=e.getGeometry();if(!(t instanceof x.A))throw new Error("Invalid line object");return(0,k.R3)(t)}intersection(e,t){let r=E.n1(e.getGeometry().getCoordinates()),n=E.n1(t.getGeometry().getCoordinates());const a=_.y(E.Lr([r,n]));if(a){let e=new G.A({geometry:new P.Ay(a.geometry.coordinates)});return e.setStyle(new g.Ay({fill:new w.A({color:"#ffff00"}),stroke:new m.A({color:"#0000ff",width:1})})),e}return console.log("No intersection found."),null}union(e,t){let r=E.n1(e.getGeometry().getCoordinates()),n=E.n1(t.getGeometry().getCoordinates());const a=O.K(E.Lr([r,n]));if(a){let e=new G.A({geometry:new P.Ay(a.geometry.coordinates)});return e.setStyle(new g.Ay({fill:new w.A({color:"#ffffff"}),stroke:new m.A({color:"#ffffff",width:1})})),e}return console.log("No union found."),null}difference(e,t){let r=E.n1(e.getGeometry().getCoordinates()),n=E.n1(t.getGeometry().getCoordinates());const a=F.i(E.Lr([r,n]));if(a){let e=new G.A({geometry:new P.Ay(a.geometry.coordinates)});return e.setStyle(new g.Ay({fill:new w.A({color:"#ffffff"}),stroke:new m.A({color:"#ff0000",width:1})})),e}return console.log("No difference found."),null}lineBuffer(e,t){const r=(new v.A).writeFeaturesObject(e,{featureProjection:"EPSG:3857"});let n=D.r(r,t,{units:"meters"});return(new v.A).readFeatures(n,{featureProjection:"EPSG:3857"})}polygonBuffer(e,t){const r=(new v.A).writeFeaturesObject(e,{featureProjection:"EPSG:3857"});let n=D.r(r,t,{units:"meters"});return(new v.A).readFeatures(n,{featureProjection:"EPSG:3857"})}}var z=Z;let R=null,H=new g.Ay({image:new A.A({radius:5,fill:new w.A({color:"rgba(0,255,0,1)"})})}),N=new g.Ay({image:new A.A({radius:5,fill:new w.A({color:"rgba(255,0,0,1)"})})}),B=new g.Ay({image:new A.A({radius:5,fill:new w.A({color:"rgba(0,0,255,0.5)"})})});var U={name:"MapPage",data(){return{layerList:[{name:"重点建设项目",url:"http://localhost/test/data/geojson/point/zdjsxm.geojson",checked:!1},{name:"重点项目选址",url:"http://localhost/test/data/geojson/point/zdxmxz.geojson",checked:!1},{name:"重点功能片区",url:"http://localhost/test/data/geojson/point/zdgnpq.geojson",checked:!1},{name:"重大项目安全控制区",url:"http://localhost/test/data/geojson/point/zdxmaqkzq.geojson",checked:!1}],mapCenter:[113.33779344641266,23.160504749489746],mapZoom:13,layerStatus:[],bufferDistance:1,analysisResult:new Set,isAnalysis:!1,bufferArray:[]}},mounted(){R=new l.A({target:"map",layers:[new u.A({zIndex:1,source:new d.A({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})})],view:new c.Ay({projection:"EPSG:3857",center:(0,y.Rb)(this.mapCenter),zoom:this.mapZoom}),interactions:(0,f.N)({doubleClickZoom:!1})}),this.layerHelper=new L(R),this.drawLayer=new h.A({style:new g.Ay({fill:new w.A({color:"rgba(143,195,179,0.7)"}),stroke:new m.A({color:"rgba( 79,253,253,1)"})}),source:new p.A({projection:"EPSG:3857"})}),this.layerHelper.addLayer(this.drawLayer),this.bufferLayer=new h.A({source:new p.A({projection:"EPSG:3857"}),style:new g.Ay({fill:new w.A({color:"rgba(143,195,179,0.7)"}),stroke:new m.A({color:"rgba( 79,253,253,1)"})})}),this.layerHelper.addLayer(this.bufferLayer),this.drawHelper=new C(R,this.drawLayer),this.computeHelper=new z,window.map=R},methods:{handleLayerClick(e){e.checked=!e.checked,e.checked?this.layerHelper.addLayer(this.loadGeojson(e.url,e.name)):this.layerHelper.removeLayer(this.loadGeojson(e.url,e.name))},loadGeojson(e,t){const r=this.layerStatus.find((e=>e.name===t));if(r)return r.layer;const n=new h.A({zIndex:3,source:new p.A({projection:"EPSG:3857",url:e,format:new v.A}),style:H});return this.layerStatus.push({name:t,layer:n}),n},removeGeojsonLayer(e){const t=[];R.getLayers().forEach((r=>{r.getSource()instanceof p.A&&r.getSource().getUrl()===e&&t.push(r)})),t.forEach((e=>R.removeLayer(e)))},setFeatureStyle(e){e.setStyle(new g.Ay({fill:new w.A({color:"rgba(255,255,0,1)"})}))},analysisEvaluate(){this.bufferLayer.getSource().clear(),this.isAnalysis=!0,this.bufferArray=[];const e=this.drawLayer.getSource().getFeatures();e.forEach((e=>{let t=this.computeHelper.polygonBuffer([e],1e3*this.bufferDistance);t.length>0&&(this.bufferLayer.getSource().addFeatures(t),this.bufferArray.push(t[0]))})),this.isPointInBuffer(this.bufferArray)},drawPolygon(){this.drawHelper.drawPolygon((()=>{}))},isPointInBuffer(e){this.analysisResult=[];const t=[],r=[],n=this.layerList.filter((e=>e.checked));e.forEach((e=>{const a=e.getGeometry();n.forEach((e=>{const n=this.layerStatus.find((t=>t.name===e.name));if(!n)return;const s=n.layer.getSource().getFeatures();let o=!1;s.forEach((e=>{const n=e.getGeometry().getLastCoordinate();r.push(e),a.intersectsCoordinate(n)&&(t.push(e),o=!0)})),o&&!this.analysisResult.includes(e.name)&&this.analysisResult.push(e.name)}))})),r.forEach((e=>{const r=t.includes(e)?N:B;e.setStyle(r)}))},triggerFileInput(){document.getElementById("fileInput").click()},handleFileUpload(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{const t=JSON.parse(e.target.result);this.loadGeojsonData(t)},e.readAsText(t)}e.target.value=""},loadGeojsonData(e){let t=(new v.A).readFeatures(e,{featureProjection:"EPSG:3857"});this.drawLayer.getSource().addFeatures(t)},clear(){this.analysisResult=new Set,this.isAnalysis=!1,this.drawLayer.getSource().clear(),this.bufferLayer.getSource().clear(),this.layerStatus.forEach((e=>{e.layer.getSource().forEachFeature((e=>{e.setStyle(H)}))}))},validateBufferDistance(){isNaN(this.bufferDistance)&&(this.bufferDistance=1)}}},M=U,T=r(1656),$=(0,T.A)(M,o,i,!1,null,"7d4356e7",null),q=$.exports,W={name:"App",components:{MapPage:q}},J=W,K=(0,T.A)(J,a,s,!1,null,null,null),V=K.exports;n.Ay.config.productionTip=!1,new n.Ay({render:e=>e(V)}).$mount("#app")}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}r.m=e,function(){var e=[];r.O=function(t,n,a,s){if(!n){var o=1/0;for(u=0;u<e.length;u++){n=e[u][0],a=e[u][1],s=e[u][2];for(var i=!0,l=0;l<n.length;l++)(!1&s||o>=s)&&Object.keys(r.O).every((function(e){return r.O[e](n[l])}))?n.splice(l--,1):(i=!1,s<o&&(o=s));if(i){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,a,s]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,s,o=n[0],i=n[1],l=n[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(l)var u=l(r)}for(t&&t(n);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(u)},n=self["webpackChunkopenlayertest"]=self["webpackChunkopenlayertest"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=r.O(void 0,[504],(function(){return r(5278)}));n=r.O(n)})();
//# sourceMappingURL=app.6b0694ad.js.map